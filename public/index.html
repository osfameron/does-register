<html ng-app>
<head>
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css" media="screen" />
    <script src="http://code.jquery.com/jquery-1.6.1.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-beta.5/angular.min.js"></script>

    <script> <!-- angular controller -->

        function MemberCtrl($scope) {
            $scope.members = [];

            $scope.refreshMembers = function (members) {
                $scope.members = members;
            };
        }

    </script>

    <script> <!-- PocketIO -->
        $(function () {
            var socket = io.connect( );
            var $scope = $('table#members').scope();

            socket.on('connect', function () {
                console.log('CONNECTED');
            });
         
            socket.on('members', function (list) {
                $scope.$apply( function () { $scope.refreshMembers( list ) });
            });

            socket.emit('hello'); // Tell server we are ready for first members list
        });
    </script>
</head>
<body>

  <div class="content">

    <table id="members" ng-controller="MemberCtrl">
        <thead>
            <tr>
                <th colspan=3> User </th>
                <th colspan=2> PAYG </th>
                <th colspan=2> Time </th>
                <th> &nbsp; </th>
            </tr>
            <tr>
                <th> &nbsp; </th> <!-- gravatar -->
                <th> Name </th> <!-- clickable -->
                <th> Type </th> <!-- Org,Perm,Tech,Ws,Fr,Fwb,Hd -->
                <th> left </th> <!-- number, and + to add more -->
                <th> used </th> <!-- select -->
                <th> in </th> <!-- hh:mm -->
                <th> out </th> <!-- hh:mm or button -->
                <th> &nbsp; </th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="member in members" class="{{ member.active ? 'active' : 'inactive' }}">
                <td> <img src="{{ member.icon }}" alt="Icon for {{ member.name }}">
                <td> {{ member.name }} </td>
                <td> {{ member.types }} </td>
                <td class="num"> {{ member.left }} </td>
                <td> 
                    <select ng-model="member.used">
                        <option selected>0</option> 
                        <option>0.25</option> 
                        <option>0.5</option> 
                        <option>1</option>
                    </select>
                </td>
                <td> {{ member.in }} </td>
                <td> <button>Left</button> </td>
                <td> &nbsp; </td>
            </tr>
        </tbody>
    </table>
  </div>
</body>  
</html>
